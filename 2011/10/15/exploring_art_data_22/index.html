<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Exploring Art Data 22 &middot; robmyers
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,900' rel='stylesheet' type='text/css'>
  <link href="/public/css/robmyers.css" rel="stylesheet">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Slideshow -->
  <script src="/public/lightbox/js/jquery-1.11.0.min.js"></script>
  <script src="/public/lightbox/js/lightbox.min.js"></script>
  <link href="/public/lightbox/css/lightbox.css" rel="stylesheet">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          robmyers
        </a>
      </h1>
      <p class="lead">"self-defined artist, writer and hacker" – MakeTank</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>
      <a class="sidebar-nav-item" href="/about/">About Me</a>

      
      
        
      
        
          <a class="sidebar-nav-item" href="/abcd/">ABCD</a>
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/art-data/">Art Data</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/critique/">Critique</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/free-culture/">Free Culture</a>
        
      
        
      
        
          <a class="sidebar-nav-item" href="/glitch-aesthetics/">Glitch Aesthetics</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a class="sidebar-nav-item" href="/shareable-readymades/">Shareable Readymades</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      

      <br>

      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>

     </nav>
    
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Exploring Art Data 22</h1>
  <span class="post-date">15 Oct 2011</span>
  <p>So far we have used the R REPL to run code. Let’s write a script that provides a command-line interface for the plotting code we have just written.</p>

<p>A command-line interface allows the code to be called via the terminal, and to be called from shell scripts. This is useful for exploratory coding and for creating pipelines and workflows of different programs. It also allows code to be called from network programming systems such as Hadoop without having to convert the code.</p>

<p>To allow the code to be called from the command line we use a “pound bang line” that tells the shell to use the Rscript interpreter rather than the interactive R system.</p>

<p>`</p>

<pre><code>#!/usr/bin/env Rscript
## -*- mode: R -*-
</code></pre>

<p><code>
Next we import the "getopt" library that we will use to parse arguments passed to the script from the command line.
</code></p>

<pre><code>library('getopt')
</code></pre>

<p><code>
And we import the properties-plot.r code that we will use to perform the actual work.
</code></p>

<pre><code>source('properties-plot.r')
</code></pre>

<p><code>
The first data and functions we write will be used to parse the arguments passed to the script by its caller. The arguments are defined in a standard format used by the getopt library.
</code></p>

<pre><code>args&lt;-matrix(ncol=4, byrow=TRUE,
c('datafile',	'd', 	1,	"character",
'imagedir',      'i',	1,	"character",
'xcolumn',	'y',	1,	"character",
'ycolumn',	'x',	1,	"character",
'labelcolumn',	'c',	1,	"character",
"xmin",          'm',     1,      "double",
"xmax",          'M',     1,      "double",
"ymin",          'n',     1,      "double",
"ymax",          'N',     1,      "double",
"plotwidth",     'p',     1,      "double",
"plotheight",    'P',     1,      "double",
"plotBorder",    'r',     1,      "double",
"thumbwidth",    't',     1,      "double",
"linewidth",     'l',     1,      "double",
"linecol",       'L',     1,      "character",
"pointsize",     'O',     1,      "double",
"pointcol",      'C',     1,      "character",
"labelsize",     'b',     1,      "double",
"labelcol",      'B',     1,      "character",
"axislabelx",    'e',     1,      "character",
"axislabely",    'E',     1,      "character",
"axiscol",       'z',     1,      "character",
"axisround",     'Z',     1,      "integer",
'outfile',       'o',     1,      "character",
'help',	        'h',	 0,      "logical",
'png',	        'G',	 0,      "logical",
'pdf',	        'D',	 0,      "logical",
'display',       'X',	 0,      "logical",
'no-axes',       'S',     0,      "logical",
'no-images',     'I',     0,      "logical",
'no-labels',     'A',     0,      "logical",
'no-points',     'T',     0,      "logical",
'no-lines',      'V',     0,      "logical"))
opt = getopt(args)
</code></pre>

<p>`
Now we have the arguments we can process them. We check for the presence of arguments to see whether the user has provided them by checking whether its value is not null.</p>

<p>It’s traditional to handle the help flag first.
`</p>

<pre><code>if(! is.null(opt$help)) {
self = commandArgs()[1];
cat(paste(getopt(args, usage=TRUE)))
q(status=1)
}
</code></pre>

<p>`
Next we check for required arguments, those arguments that the user must have provided in order for the code to run. Rather than checking each argument individually we list the required arguments in a vector and then check for their presence using set intersection. If the resulting set isn’t empty, we build a string describing the missing arguments and use it to print an error message before exiting the script.</p>

<p>`</p>

<pre><code>required&lt;-c("datafile", "imagedir", "xcolumn", "ycolumn")
checkRequiredArgs&lt;-function(opts, required){
missing&lt;-setdiff(required, names(opts))
if(length(missing) != 0){
args&lt;-paste("", missing, sep=" --")
cat("Missing parameters:")
cat(paste(missing))
cat("\n")
quit(status=1)
}
}
</code></pre>

<p><code>
Then we set the global variables from properties-plot.r to the command line arguments that have been provided for them. We map the argument name to the variable name and then where it is present we use the assign function to set the variable.
</code></p>

<pre><code>value.mappings&lt;-matrix(ncol=2, byrow=TRUE,
c("xmin", "minXValue",
"linecol", "lineCol",
"plotwidth", "plotWidth",
"plotheight", "plotHeight",
"plotBorder", "plotBorder",
"thumbwidth", "thumbnailWidth",
"linewidth", "lineWidth",
"linecol", "lineCol",
"pointsize", "pointSize",
"pointcol", "pointCol",
"labelsize", "labelSize",
"labelcol", "labelCol",
"axislabelx", "axisLabelX",
"axislabely", "axisLabelY",
"axiscol", "axisCol",
"axisround", "axisRoundDigits"))
valueOpts&lt;-function(opts, mappings){
for(i in 1:dim(mappings)[2]){
mapping&lt;-mappings[i,]
if(! is.null(opts[[mapping[1]]])){
assign(mapping[2], opts[[mapping[1]]], inherits=TRUE)
}
}
}
</code></pre>

<p><code>
Some arguments need to be set to a boolean value if a particular argument is present as a flag or not. We use a similar technique for this, but the matrix containing themapping from argument to variable also has a boolean value that is used to set the variable rather than fetching an argument value.
</code></p>

<pre><code>boolean.mappings&lt;-matrix(ncol=3, byrow=TRUE,
c("no-images", "shouldDrawImages", FALSE,
"no-points", "shouldDrawPoints", FALSE,
"no-lines", "shouldDrawLines", FALSE,
"no-labels", "shouldDrawLabels", FALSE,
"no-axes", "shouldDrawAxes", FALSE))
booleanOpts&lt;-function(opts, mappings){
for(i in 1:dim(mappings)[2]){
mapping&lt;-mappings[i,]
if(! is.null(opts[[mapping[1]]])){
assign(mapping[2], mapping[3], inherits=TRUE)
}
}
}
</code></pre>

<p><code>
The render type is specified through the arguments passed to the script, but we only want to perform one kind of render. We check that only one kind of render was specified or else we quit with an informative error message.
</code></p>

<pre><code>renderTypeCount&lt;-sum(as.integer(opt$pdf, opt$png, opt$display))
if(renderTypeCount &gt; 1){
cat("Please specify only one of png, pdf or display to render\n")
q(status=1)
}
</code></pre>

<p><code>
We get the file name to save the render as, if needed.
</code></p>

<pre><code>getOutfile&lt;-function(opt){
if((! is.null(opt$display)) &amp;&amp; is.null(opt$outfile)){
cat("Missing parameter: --outfile|-o &lt;filename&gt;\n")
q(status=1)
}
opt$outfile
}
</code></pre>

<p><code>
The last bit of configuration we get is the column to use for filenames in the data file, if it's provided, otherwise we default to "filename".
</code></p>

<pre><code>getFilenameColumn&lt;-function(opt){
if(! is.null(opt$labelColumn)){
opt$labelColumn
} else {
"filename"
}
}
</code></pre>

<p><code>
The last function we define in the script performs the render specified in the arguments to the script.
</code></p>

<pre><code>render&lt;-function(opt){
if(! is.null(opt$pdf)){
## render pdf
pdfPlot(getOutfile(opt), opt$datafile, opt$imagedir, opt$xcolumn,
opt$ycolumn, getFilenameColumn(opt))
q(status=0)
} else if (! is.null(opt$png)){
## render png
pngPlot(getOutfile(opt), opt$datafile, opt$imagedir, opt$xcolumn,
opt$ycolumn, getFilenameColumn(opt))
q(status=0)
} else {
## render display
X11Plot(opt$datafile, opt$imagedir, opt$xcolumn, opt$ycolumn,
getFilenameColumn(opt))
## Stop R exiting and closing the window straight away...
Sys.sleep(3600000)
}
}
</code></pre>

<p><code>
Finally, outside of any function, we call the functions we have defined in order to do the work of processing the parameters and calling the code.
</code></p>

<pre><code>checkRequiredArgs(opt, required)
valueOpts(opt, value.mappings)
booleanOpts(opt, boolean.mappings)
render(opt)
</code></pre>

<p>`
If we save this code in a file called propcli and make it executable using the shell command:</p>

<p>chmod +x propcli</p>

<p>We can call the script from the command line like this:</p>

<p>./propcli –datafile images.txt –imagedir images –xcolumn saturation_median –ycolumn hue_median</p>


</div>

<ul class="share-buttons">
  <li><a href="https://www.reddit.com/r/robmyers/submit?url=https://robmyers.org/2011/10/15/exploring_art_data_22/&title=Exploring Art Data 22" target="_blank" title="Submit to Reddit"><img src="/public/flat_web_icon_set/black/Reddit.png"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https://robmyers.org/2011/10/15/exploring_art_data_22/&text=Exploring Art Data 22:%20https://robmyers.org/2011/10/15/exploring_art_data_22/&via=robmyers" target="_blank" title="Tweet"><img src="/public/flat_web_icon_set/black/Twitter.png"></a></li>
  <li><a href="https://wordpress.com/press-this.php?u=https://robmyers.org/2011/10/15/exploring_art_data_22/&t=Exploring Art Data 22" target="_blank" title="Publish on WordPress"><img src="/public/flat_web_icon_set/black/Wordpress.png"></a></li>
  <li><a href="https://www.tumblr.com/share?v=3&u=https://robmyers.org/2011/10/15/exploring_art_data_22/&t=Exploring Art Data 22&s=" target="_blank" title="Post to Tumblr"><img src="/public/flat_web_icon_set/black/Tumblr.png"></a></li>
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https://robmyers.org/2011/10/15/exploring_art_data_22/&t=Exploring Art Data 22" title="Share on Facebook" target="_blank"><img src="/public/flat_web_icon_set/black/Facebook.png"></a></li>
  <li><a href="mailto:?subject=Exploring Art Data 22&body=https://robmyers.org/2011/10/15/exploring_art_data_22/" target="_blank" title="Email"><img src="/public/flat_web_icon_set/black/Email.png"></a></li>
</ul>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/06/11/trying-jekyll/">
            Trying Jekyll
            <small>11 Jun 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/05/01/my-little-penny-bitcoin-is-magic/">
            My Little Penny - Bitcoin Is Magic
            <small>01 May 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/02/05/art-for-algorithms/">
            Art For Algorithms
            <small>05 Feb 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
